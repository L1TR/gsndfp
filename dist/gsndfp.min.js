/*!
 * gsndfp
 * version 1.1.0
 * Requires jQuery 1.7.1 or higher
 * git@github.com:gsn/gsndfp.git
 * License: Grocery Shopping Network
 *          MIT from derived work of Copyright (c) 2013 Matt Cooper: https://github.com/coop182/jquery.dfp.js  v1.0.18
 */
!function($,window){"use strict";var $adCollection,count,createAds,dfpBlocked,dfpID,dfpIsLoaded,dfpLoader,dfpOptions,dfpScript,dfpSelector,displayAds,getDimensions,getID,init,isInView,lastRefreshTime,refreshHandler,rendered,sessionStorageX,setOptions,storeAs;sessionStorageX=sessionStorage,"undefined"==typeof sessionStorageX&&(sessionStorageX={getItem:function(){},setItem:function(){}}),dfpScript=this,dfpID="",count=0,rendered=0,dfpSelector=".gsnunit",dfpOptions={},dfpIsLoaded=!1,$adCollection=void 0,storeAs="gsnUnit",lastRefreshTime=new Date,init=function(e,t,n){dfpID=e,$adCollection=$(t),dfpLoader(),setOptions(n),$(function(){createAds(),displayAds(),$("body").on("click",dfpOptions.refreshTarget,refreshHandler)})},setOptions=function(e){dfpOptions={setTargeting:{},setCategoryExclusion:"",setLocation:"",enableSingleRequest:!0,collapseEmptyDivs:!0,refreshExisting:!0,disablePublisherConsole:!1,disableInitialLoad:!1,inViewOnly:!1,noFetch:!1,refreshTarget:".gsnunit-refresh-target",minSecondBetweenRefresh:5},$.extend(!0,dfpOptions,e),dfpOptions.googletag&&window.googletag.cmd.push(function(){$.extend(!0,window.googletag,dfpOptions.googletag)})},createAds=function(){$adCollection.each(function(){var $adUnit,$existingContent,adUnitID,dimensions;$adUnit=$(this),count++,adUnitID=getID($adUnit,"gsn",count),dimensions=getDimensions($adUnit),$existingContent=$adUnit.html(),$adUnit.html("").addClass("display-none"),window.googletag.cmd.push(function(){var $adUnitData,exclusions,exclusionsGroup,googleAdUnit,targeting,valueTrimmed;googleAdUnit=void 0,$adUnitData=$adUnit.data(storeAs),$adUnitData||(dfpID=dfpID.replace(/(\/\/)+/gi,"/").replace(/\s+/gi,"").replace(/(\/)$/,"/"),0!==dfpID.indexOf("/")&&(dfpID="/"+dfpID),googleAdUnit=$adUnit.data("outofpage")?window.googletag.defineOutOfPageSlot(dfpID,adUnitID).addService(window.googletag.pubads()):window.googletag.defineSlot(dfpID,dimensions,adUnitID).addService(window.googletag.pubads()),targeting=$adUnit.data("targeting"),targeting&&("string"==typeof targeting&&(targeting=eval("("+targeting+")")),$.each(targeting,function(e,t){"brand"===e&&sessionStorageX.setItem("brand",t),googleAdUnit.setTargeting(e,t)})),exclusions=$adUnit.data("exclusions"),exclusions&&(exclusionsGroup=exclusions.split(","),valueTrimmed=void 0,$.each(exclusionsGroup,function(e,t){valueTrimmed=$.trim(t),valueTrimmed.length>0&&googleAdUnit.setCategoryExclusion(valueTrimmed)})),googleAdUnit.oldRenderEnded=googleAdUnit.oldRenderEnded||googleAdUnit.renderEnded,googleAdUnit.renderEnded=function(){var e;rendered++,e=$adUnit.css("display"),$adUnit.removeClass("display-none").addClass("display-"+e),googleAdUnit.oldRenderEnded(),"function"==typeof dfpOptions.afterEachAdLoaded&&dfpOptions.afterEachAdLoaded.call(this,$adUnit),"function"==typeof dfpOptions.afterAllAdsLoaded&&rendered===count&&dfpOptions.afterAllAdsLoaded.call(this,$adCollection)},$adUnit.data(storeAs,googleAdUnit))})}),window.googletag.cmd.push(function(){var e,t;"undefined"==typeof dfpOptions.setTargeting.brand&&sessionStorageX.getItem("brand")&&(dfpOptions.setTargeting.brand=sessionStorageX.getItem("brand")),dfpOptions.enableSingleRequest===!0&&window.googletag.pubads().enableSingleRequest(),$.each(dfpOptions.setTargeting,function(e,t){"brand"===e&&sessionStorageX.setItem("brand",t),window.googletag.pubads().setTargeting(e,t)}),"object"==typeof dfpOptions.setLocation&&("number"==typeof dfpOptions.setLocation.latitude&&"number"==typeof dfpOptions.setLocation.longitude&&"number"==typeof dfpOptions.setLocation.precision?window.googletag.pubads().setLocation(dfpOptions.setLocation.latitude,dfpOptions.setLocation.longitude,dfpOptions.setLocation.precision):"number"==typeof dfpOptions.setLocation.latitude&&"number"==typeof dfpOptions.setLocation.longitude&&window.googletag.pubads().setLocation(dfpOptions.setLocation.latitude,dfpOptions.setLocation.longitude)),dfpOptions.setCategoryExclusion.length>0&&(e=dfpOptions.setCategoryExclusion.split(","),t=void 0,$.each(e,function(e,n){t=$.trim(n),t.length>0&&window.googletag.pubads().setCategoryExclusion(t)})),dfpOptions.collapseEmptyDivs&&window.googletag.pubads().collapseEmptyDivs(),dfpOptions.disablePublisherConsole===!0&&window.googletag.pubads().disablePublisherConsole(),dfpOptions.disableInitialLoad===!0&&window.googletag.pubads().disableInitialLoad(),dfpOptions.noFetch===!0&&window.googletag.pubads().noFetch(),window.googletag.enableServices()})},isInView=function(e){var t,n,o,i;return n=$(window).scrollTop(),t=n+$(window).height(),i=e.offset().top,o=i+e.height(),i+(o-i)/2>=n&&t>=i+(o-i)/2},refreshHandler=function(){(new Date).getSeconds()-lastRefreshTime.getSeconds()>=dfpOptions.minSecondBetweenRefresh&&(Gsn.Advertising.refreshAdPods(),lastRefreshTime=new Date)},displayAds=function(){var e;e=[],$adCollection.each(function(){var t,n;t=$(this),n=t.data(storeAs),dfpOptions.refreshExisting&&n&&t.data("gsnDfpExisting")?(!dfpOptions.inViewOnly||isInView(t)&&t.is(":visible"))&&e.push(n):(t.data("gsnDfpExisting",!0),window.googletag.cmd.push(function(){window.googletag.display(t.attr("id"))}))}),e.length>0&&window.googletag.cmd.push(function(){window.googletag.pubads().refresh(e)})},getID=function(e,t,n){return dfpOptions.refreshExisting||(e.data(storeAs,null),e.data("gsnDfpExisting",null),e.attr("id")&&e.attr("id",t+"-auto-gen-id-"+n)),e.attr("id")||e.attr("id",t+"-auto-gen-id-"+n).attr("id")},getDimensions=function(e){var t,n,o;return n=[],o=e.data("dimensions"),o?(t=o.split(","),$.each(t,function(e,t){var o;o=t.split("x"),n.push([parseInt(o[0],10),parseInt(o[1],10)])})):n.push([e.width(),e.height()]),n},dfpLoader=function(){var e,t,n;dfpIsLoaded=dfpIsLoaded||$('script[src*="googletagservices.com/tag/js/gpt.js"]').length,dfpIsLoaded||(window.googletag=window.googletag||{},window.googletag.cmd=window.googletag.cmd||[],e=document.createElement("script"),e.async=!0,e.type="text/javascript",e.onerror=function(){dfpBlocked()},n="https:"===document.location.protocol,e.src=(n?"https:":"http:")+"//www.googletagservices.com/tag/js/gpt.js",t=document.getElementsByTagName("script")[0],t.parentNode.insertBefore(e,t),"none"===e.style.display&&dfpBlocked())},dfpBlocked=function(){var e;e=window.googletag.cmd,setTimeout(function(){var t;t=function(e,t,n){return window.googletag.ads.push(n),window.googletag.ads[n]={renderEnded:function(){},addService:function(){return this}},window.googletag.ads[n]},window.googletag={cmd:{push:function(e){e.call(dfpScript)}},ads:[],pubads:function(){return this},noFetch:function(){return this},disableInitialLoad:function(){return this},disablePublisherConsole:function(){return this},enableSingleRequest:function(){return this},setTargeting:function(){return this},collapseEmptyDivs:function(){return this},enableServices:function(){return this},defineSlot:function(e,n,o){return t(e,n,o,!1)},defineOutOfPageSlot:function(e,n){return t(e,[],n,!0)},display:function(e){return window.googletag.ads[e].renderEnded.call(dfpScript),this}},$.each(e,function(e,t){window.googletag.cmd.push(t)})},50)},$.gsnDfp=$.fn.gsnDfp=function(e,t){var n;return t=t||{},void 0===e&&(e=dfpID),"object"==typeof e&&(t=e,e=t.dfpID||dfpID),n=this,"function"==typeof this&&(n=dfpSelector),init(e,n,t),this}}(window.jQuery||window.Zepto||window.tire||window.$,window),function($,window){"use strict";var $adCollection,advertUrl,apiUrl,chainId,clean,clearCookie,count,createAds,cssUrl,dfpBlocked,dfpID,dfpIsLoaded,dfpLoader,dfpOptions,dfpScript,dfpSelector,didOpen,displayAds,getCookie,getDimensions,getID,getPopup,init,onCloseCallback,onOpenCallback,rendered,sessionStorageX,setAdvertisingTester,setCookie,setOptions,setResponsiveCss,storeAs;sessionStorageX=sessionStorage,"undefined"==typeof sessionStorageX&&(sessionStorageX={getItem:function(){},setItem:function(){}}),dfpScript=this,dfpID="",count=0,rendered=0,dfpSelector=".gsnsw",dfpOptions={},dfpIsLoaded=!1,$adCollection=void 0,storeAs="gsnsw",apiUrl="https://clientapi.gsn2.com/api/v1/ShopperWelcome/GetShopperWelcome/",cssUrl="http://cdn.gsngrocers.com/script/sw2/1.1.0/sw2-override.css",advertUrl="http://cdn.gsngrocers.com/script/sw2/1.1.0/advertisement.js",chainId=0,didOpen=!1,init=function(e,t,n){var o,i;setOptions(n),i=dfpOptions.cssUrl||cssUrl,o=dfpOptions.advertUrl||advertUrl,dfpOptions.cancel&&onCloseCallback({cancel:!0}),setResponsiveCss(i),setAdvertisingTester(o),null===getCookie("shopperwelcome2")?(dfpID=e,dfpLoader(),getPopup(t),Gsn.Advertising.on("clickBrand",function(){$(".sw-close").click()})):onCloseCallback({cancel:!0})},setResponsiveCss=function(e){var t,n;0===$(".respo").length&&(n=document.getElementsByTagName("head").item(0),t=document.createElement("link"),t.setAttribute("href",e),t.setAttribute("rel","stylesheet"),t.setAttribute("class","respo"),n.appendChild(t))},setAdvertisingTester=function(e){var t,n;0===$(".advert").length&&(t=document.getElementsByTagName("body").item(0),n=document.createElement("script"),n.setAttribute("src",e),n.setAttribute("class","advert"),t.appendChild(n))},onOpenCallback=function(){didOpen=!0,setTimeout(function(){"undefined"==typeof gsnGlobalTester&&(jQuery(".sw-msg").show(),jQuery(".sw-header-copy").hide(),jQuery(".sw-row").hide())},150)},onCloseCallback=function(){$(".sw-pop").remove(),$(".lean-overlay").remove(),window.scrollTo(0,0),null===getCookie("shopperwelcome2")&&setCookie("shopperwelcome2","shopperwelcome2",1),"function"==typeof dfpOptions.onClose&&dfpOptions.onClose(didOpen)},getPopup=function(e){var t,n;n=dfpOptions.apiUrl||apiUrl,t=dfpOptions.chainId||chainId,$.ajax({url:n+t,dataType:"json",success:function(n){var o,i;n?(n=n.replace(/%%CACHEBUSTER%%/g,(new Date).getTime()).replace(/%%CHAINID%%/g,t),0===$("#sw").length&&(o=document.getElementsByTagName("body").item(0),i=document.createElement("div"),i.setAttribute("id","sw"),o.appendChild(i)),$("#sw").html(clean(n)),$adCollection=$(e),$adCollection&&(createAds(),displayAds(),$(".sw-pop").easyModal({autoOpen:!0,closeOnEscape:!1,onClose:onCloseCallback,onOpen:onOpenCallback,top:25}))):onCloseCallback({cancel:!0})}})},clean=function(e){var t;return t=$(e.trim()),$(".remove",t).remove(),t.prop("outerHTML")},getCookie=function(e){var t,n;return document.cookie.length>0&&(t=document.cookie.indexOf(e+"="),n=0,-1!==t)?(t+=e.length+1,n=document.cookie.indexOf(";",t),-1===n&&(n=document.cookie.length),decodeURI(document.cookie.substring(t,n))):null},setCookie=function(e,t,n){var o;o=new Date,o.setTime(o.getTime()+24*n*3600*1e3),document.cookie=e+"="+encodeURI(t)+(null===n?"":"; expires="+o.toGMTString())+"; path=/"},clearCookie=function(e){e===getCookie(e)&&(document.cookie=e+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT")},setOptions=function(e){dfpOptions={setTargeting:{},setCategoryExclusion:"",setLocation:"",enableSingleRequest:!0,collapseEmptyDivs:!0,refreshExisting:!0,disablePublisherConsole:!1,disableInitialLoad:!1,noFetch:!1},$.extend(!0,dfpOptions,e),dfpOptions.googletag&&window.googletag.cmd.push(function(){$.extend(!0,window.googletag,dfpOptions.googletag)})},createAds=function(){$adCollection.each(function(){var $adUnit,$existingContent,adUnitID,dimensions;$adUnit=$(this),count++,adUnitID=getID($adUnit,"gsnsw",count),dimensions=getDimensions($adUnit),$existingContent=$adUnit.html(),$adUnit.html("").addClass("display-none"),window.googletag.cmd.push(function(){var $adUnitData,exclusions,exclusionsGroup,googleAdUnit,targeting,valueTrimmed;googleAdUnit=void 0,$adUnitData=$adUnit.data(storeAs),$adUnitData||(dfpID=dfpID.replace(/(\/\/)+/gi,"/").replace(/\s+/gi,"").replace(/(\/)$/,"/"),0!==dfpID.indexOf("/")&&(dfpID="/"+dfpID),googleAdUnit=$adUnit.data("outofpage")?window.googletag.defineOutOfPageSlot(dfpID,adUnitID).addService(window.googletag.pubads()):window.googletag.defineSlot(dfpID,dimensions,adUnitID).addService(window.googletag.pubads()),targeting=$adUnit.data("targeting"),targeting&&("string"==typeof targeting&&(targeting=eval("("+targeting+")")),$.each(targeting,function(e,t){"brand"===e&&sessionStorageX.setItem("brand",t),googleAdUnit.setTargeting(e,t)})),exclusions=$adUnit.data("exclusions"),exclusions&&(exclusionsGroup=exclusions.split(","),valueTrimmed=void 0,$.each(exclusionsGroup,function(e,t){valueTrimmed=$.trim(t),valueTrimmed.length>0&&googleAdUnit.setCategoryExclusion(valueTrimmed)})),googleAdUnit.oldRenderEnded=googleAdUnit.oldRenderEnded||googleAdUnit.renderEnded,googleAdUnit.renderEnded=function(){var e;rendered++,e=$adUnit.css("display"),$adUnit.removeClass("display-none").addClass("display-"+e),"function"==typeof dfpOptions.afterEachAdLoaded&&dfpOptions.afterEachAdLoaded.call(this,$adUnit),"function"==typeof dfpOptions.afterAllAdsLoaded&&rendered===count&&dfpOptions.afterAllAdsLoaded.call(this,$adCollection)},$adUnit.data(storeAs,googleAdUnit))})}),window.googletag.cmd.push(function(){var e,t;"undefined"==typeof dfpOptions.setTargeting.brand&&sessionStorageX.getItem("brand")&&(dfpOptions.setTargeting.brand=sessionStorageX.getItem("brand")),dfpOptions.enableSingleRequest===!0&&window.googletag.pubads().enableSingleRequest(),$.each(dfpOptions.setTargeting,function(e,t){"brand"===e&&sessionStorageX.setItem("brand",t),window.googletag.pubads().setTargeting(e,t)}),"object"==typeof dfpOptions.setLocation&&("number"==typeof dfpOptions.setLocation.latitude&&"number"==typeof dfpOptions.setLocation.longitude&&"number"==typeof dfpOptions.setLocation.precision?window.googletag.pubads().setLocation(dfpOptions.setLocation.latitude,dfpOptions.setLocation.longitude,dfpOptions.setLocation.precision):"number"==typeof dfpOptions.setLocation.latitude&&"number"==typeof dfpOptions.setLocation.longitude&&window.googletag.pubads().setLocation(dfpOptions.setLocation.latitude,dfpOptions.setLocation.longitude)),dfpOptions.setCategoryExclusion.length>0&&(e=dfpOptions.setCategoryExclusion.split(","),t=void 0,$.each(e,function(e,n){t=$.trim(n),t.length>0&&window.googletag.pubads().setCategoryExclusion(t)})),dfpOptions.collapseEmptyDivs&&window.googletag.pubads().collapseEmptyDivs(),dfpOptions.disablePublisherConsole===!0&&window.googletag.pubads().disablePublisherConsole(),dfpOptions.disableInitialLoad===!0&&window.googletag.pubads().disableInitialLoad(),dfpOptions.noFetch===!0&&window.googletag.pubads().noFetch(),window.googletag.enableServices()})},displayAds=function(){var e;e=[],$adCollection.each(function(){var t,n;t=$(this),n=t.data(storeAs),dfpOptions.refreshExisting&&n&&t.data("gsnDfpExisting")?e.push(n):(t.data("gsnDfpExisting",!0),window.googletag.cmd.push(function(){window.googletag.display(t.attr("id"))}))}),e.length>0&&window.googletag.cmd.push(function(){window.googletag.pubads().refresh(e)})},getID=function(e,t,n){return dfpOptions.refreshExisting||(e.data(storeAs,null),e.data("gsnDfpExisting",null),e.attr("id")&&e.attr("id",t+"-auto-gen-id-"+n)),e.attr("id")||e.attr("id",t+"-auto-gen-id-"+n).attr("id")},getDimensions=function(e){var t,n,o;return n=[],o=e.data("dimensions"),o?(t=o.split(","),$.each(t,function(e,t){var o;o=t.split("x"),n.push([parseInt(o[0],10),parseInt(o[1],10)])})):n.push([e.width(),e.height()]),n},dfpLoader=function(){var e,t,n;dfpIsLoaded=dfpIsLoaded||$('script[src*="googletagservices.com/tag/js/gpt.js"]').length,dfpIsLoaded||(window.googletag=window.googletag||{},window.googletag.cmd=window.googletag.cmd||[],e=document.createElement("script"),e.async=!0,e.type="text/javascript",e.onerror=function(){dfpBlocked()},n="https:"===document.location.protocol,e.src=(n?"https:":"http:")+"//www.googletagservices.com/tag/js/gpt.js",t=document.getElementsByTagName("script")[0],t.parentNode.insertBefore(e,t),"none"===e.style.display&&dfpBlocked())},dfpBlocked=function(){var e;e=window.googletag.cmd,setTimeout(function(){var t;t=function(e,t,n){return window.googletag.ads.push(n),window.googletag.ads[n]={renderEnded:function(){},addService:function(){return this}},window.googletag.ads[n]},window.googletag={cmd:{push:function(e){e.call(dfpScript)}},ads:[],pubads:function(){return this},noFetch:function(){return this},disableInitialLoad:function(){return this},disablePublisherConsole:function(){return this},enableSingleRequest:function(){return this},setTargeting:function(){return this},collapseEmptyDivs:function(){return this},enableServices:function(){return this},defineSlot:function(e,n,o){return t(e,n,o,!1)},defineOutOfPageSlot:function(e,n){return t(e,[],n,!0)},display:function(e){return window.googletag.ads[e].renderEnded.call(dfpScript),this}},$.each(e,function(e,t){window.googletag.cmd.push(t)})},50)},$.gsnSw2=$.fn.gsnSw2=function(e,t){var n;return t=t||{},void 0===e&&(e=dfpID),"object"==typeof e&&(t=e,e=t.dfpID||dfpID),n=this,"function"==typeof this&&(n=dfpSelector),$(t.displayWhenExists||".gsnunit").length&&init(e,n,t),this}}(window.jQuery||window.Zepto||window.tire||window.$,window);