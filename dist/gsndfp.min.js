/*!
 * gsndfp
 * version 1.1.0
 * Requires jQuery 1.7.1 or higher
 * git@github.com:gsn/gsndfp.git
 * License: Grocery Shopping Network
 *          MIT from derived work of Copyright (c) 2013 Matt Cooper: https://github.com/coop182/jquery.dfp.js  v1.0.18
 */
!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define(t);else{var n=t();for(var o in n)("object"==typeof exports?exports:e)[o]=n[o]}}(this,function(){return function(e){function t(o){if(n[o])return n[o].exports;var i=n[o]={exports:{},id:o,loaded:!1};return e[o].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(module,exports,__webpack_require__){!function($,window,undefined){"use strict";var sessionStorageX=sessionStorage;"undefined"==typeof sessionStorageX&&(sessionStorageX={getItem:function(){},setItem:function(){}});var dfpScript=this,dfpID="",count=0,rendered=0,dfpSelector=".gsnunit",dfpOptions={},dfpIsLoaded=!1,$adCollection,storeAs="gsnUnit",lastRefreshTime=new Date,init=function(e,t,n){dfpID=e,$adCollection=$(t),dfpLoader(),setOptions(n),$(function(){createAds(),displayAds(),$("body").on("click",dfpOptions.refreshTarget,refreshHandler)})},setOptions=function(e){dfpOptions={setTargeting:{},setCategoryExclusion:"",setLocation:"",enableSingleRequest:!0,collapseEmptyDivs:!0,refreshExisting:!0,disablePublisherConsole:!1,disableInitialLoad:!1,inViewOnly:!1,noFetch:!1,refreshTarget:".gsnunit-refresh-target",minSecondBetweenRefresh:5},$.extend(!0,dfpOptions,e),dfpOptions.googletag&&window.googletag.cmd.push(function(){$.extend(!0,window.googletag,dfpOptions.googletag)})},createAds=function(){$adCollection.each(function(){var $adUnit=$(this);count++;var adUnitID=getID($adUnit,"gsn",count),dimensions=getDimensions($adUnit),$existingContent=$adUnit.html();$adUnit.html("").addClass("display-none"),window.googletag.cmd.push(function(){var googleAdUnit,$adUnitData=$adUnit.data(storeAs);if(!$adUnitData){dfpID=dfpID.replace(/(\/\/)+/gi,"/").replace(/\s+/gi,"").replace(/(\/)$/,"/"),0!=dfpID.indexOf("/")&&(dfpID="/"+dfpID),googleAdUnit=$adUnit.data("outofpage")?window.googletag.defineOutOfPageSlot(dfpID,adUnitID).addService(window.googletag.pubads()):window.googletag.defineSlot(dfpID,dimensions,adUnitID).addService(window.googletag.pubads());var targeting=$adUnit.data("targeting");targeting&&("string"==typeof targeting&&(targeting=eval("("+targeting+")")),$.each(targeting,function(e,t){"brand"==e&&sessionStorageX.setItem("brand",t),googleAdUnit.setTargeting(e,t)}));var exclusions=$adUnit.data("exclusions");if(exclusions){var exclusionsGroup=exclusions.split(","),valueTrimmed;$.each(exclusionsGroup,function(e,t){valueTrimmed=$.trim(t),valueTrimmed.length>0&&googleAdUnit.setCategoryExclusion(valueTrimmed)})}googleAdUnit.oldRenderEnded=googleAdUnit.oldRenderEnded||googleAdUnit.renderEnded,googleAdUnit.renderEnded=function(){rendered++;var e=$adUnit.css("display");$adUnit.removeClass("display-none").addClass("display-"+e),googleAdUnit.oldRenderEnded(),"function"==typeof dfpOptions.afterEachAdLoaded&&dfpOptions.afterEachAdLoaded.call(this,$adUnit),"function"==typeof dfpOptions.afterAllAdsLoaded&&rendered===count&&dfpOptions.afterAllAdsLoaded.call(this,$adCollection)},$adUnit.data(storeAs,googleAdUnit)}})}),window.googletag.cmd.push(function(){if("undefined"==typeof dfpOptions.setTargeting.brand&&sessionStorageX.getItem("brand")&&(dfpOptions.setTargeting.brand=sessionStorageX.getItem("brand")),dfpOptions.enableSingleRequest===!0&&window.googletag.pubads().enableSingleRequest(),$.each(dfpOptions.setTargeting,function(e,t){"brand"==e&&sessionStorageX.setItem("brand",t),window.googletag.pubads().setTargeting(e,t)}),"object"==typeof dfpOptions.setLocation&&("number"==typeof dfpOptions.setLocation.latitude&&"number"==typeof dfpOptions.setLocation.longitude&&"number"==typeof dfpOptions.setLocation.precision?window.googletag.pubads().setLocation(dfpOptions.setLocation.latitude,dfpOptions.setLocation.longitude,dfpOptions.setLocation.precision):"number"==typeof dfpOptions.setLocation.latitude&&"number"==typeof dfpOptions.setLocation.longitude&&window.googletag.pubads().setLocation(dfpOptions.setLocation.latitude,dfpOptions.setLocation.longitude)),dfpOptions.setCategoryExclusion.length>0){var e,t=dfpOptions.setCategoryExclusion.split(",");$.each(t,function(t,n){e=$.trim(n),e.length>0&&window.googletag.pubads().setCategoryExclusion(e)})}dfpOptions.collapseEmptyDivs&&window.googletag.pubads().collapseEmptyDivs(),dfpOptions.disablePublisherConsole===!0&&window.googletag.pubads().disablePublisherConsole(),dfpOptions.disableInitialLoad===!0&&window.googletag.pubads().disableInitialLoad(),dfpOptions.noFetch===!0&&window.googletag.pubads().noFetch(),window.googletag.enableServices()})},isInView=function(e){var t=$(window).scrollTop(),n=t+$(window).height(),o=e.offset().top,i=o+e.height();return o+(i-o)/2>=t&&n>=o+(i-o)/2},refreshHandler=function(){(new Date).getSeconds()-lastRefreshTime.getSeconds()>=dfpOptions.minSecondBetweenRefresh&&(Gsn.Advertising.refreshAdPods(),lastRefreshTime=new Date)},displayAds=function(){var e=[];$adCollection.each(function(){var t=$(this),n=t.data(storeAs);dfpOptions.refreshExisting&&n&&t.data("gsnDfpExisting")?(!dfpOptions.inViewOnly||isInView(t)&&t.is(":visible"))&&e.push(n):(t.data("gsnDfpExisting",!0),window.googletag.cmd.push(function(){window.googletag.display(t.attr("id"))}))}),e.length>0&&window.googletag.cmd.push(function(){window.googletag.pubads().refresh(e)})},getID=function(e,t,n){return dfpOptions.refreshExisting||(e.data(storeAs,null),e.data("gsnDfpExisting",null),e.attr("id")&&e.attr("id",t+"-auto-gen-id-"+n)),e.attr("id")||e.attr("id",t+"-auto-gen-id-"+n).attr("id")},getDimensions=function(e){var t=[],n=e.data("dimensions");if(n){var o=n.split(",");$.each(o,function(e,n){var o=n.split("x");t.push([parseInt(o[0],10),parseInt(o[1],10)])})}else t.push([e.width(),e.height()]);return t},dfpLoader=function(){if(dfpIsLoaded=dfpIsLoaded||$('script[src*="googletagservices.com/tag/js/gpt.js"]').length,!dfpIsLoaded){window.googletag=window.googletag||{},window.googletag.cmd=window.googletag.cmd||[];var e=document.createElement("script");e.async=!0,e.type="text/javascript",e.onerror=function(){dfpBlocked()};var t="https:"===document.location.protocol;e.src=(t?"https:":"http:")+"//www.googletagservices.com/tag/js/gpt.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n),"none"===e.style.display&&dfpBlocked()}},dfpBlocked=function(){var e=window.googletag.cmd;setTimeout(function(){var t=function(e,t,n){return window.googletag.ads.push(n),window.googletag.ads[n]={renderEnded:function(){},addService:function(){return this}},window.googletag.ads[n]};window.googletag={cmd:{push:function(e){e.call(dfpScript)}},ads:[],pubads:function(){return this},noFetch:function(){return this},disableInitialLoad:function(){return this},disablePublisherConsole:function(){return this},enableSingleRequest:function(){return this},setTargeting:function(){return this},collapseEmptyDivs:function(){return this},enableServices:function(){return this},defineSlot:function(e,n,o){return t(e,n,o,!1)},defineOutOfPageSlot:function(e,n){return t(e,[],n,!0)},display:function(e){return window.googletag.ads[e].renderEnded.call(dfpScript),this}},$.each(e,function(e,t){window.googletag.cmd.push(t)})},50)};$.gsnDfp=$.fn.gsnDfp=function(e,t){t=t||{},e===undefined&&(e=dfpID),"object"==typeof e&&(t=e,e=t.dfpID||dfpID);var n=this;return"function"==typeof this&&(n=dfpSelector),init(e,n,t),this}}(window.jQuery||window.Zepto||window.tire,window)}])});